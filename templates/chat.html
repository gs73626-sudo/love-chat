<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>åªå±äºæˆ‘ä»¬ ğŸ’—</title>
<link rel="stylesheet" href="/static/style.css">
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>

<body>

<div class="chat-wrapper">
  <div class="chat-header">ğŸ’¬ æˆ‘ä»¬çš„èŠå¤©</div>

  <div id="chat" class="chat-box"></div>

  <form id="form" class="chat-input">
    <input id="msg" placeholder="è¯´ç‚¹ä»€ä¹ˆå§â€¦" autocomplete="off">
    <label class="img-btn">
      ğŸ“·
      <input type="file" id="img" hidden>
    </label>
    <button>å‘é€</button>
  </form>
</div>

<script>
const socket = io();
const user = "{{ user }}";

socket.on("history", msgs => {
  chat.innerHTML = "";
  msgs.forEach(addMsg);
});

socket.on("new_message", addMsg);

function addMsg(m) {
  const d = document.createElement("div");
  d.className = "bubble " + (m.sender === user ? "me" : "her");

  d.innerHTML = `
    ${m.type === "text" ? m.content : `<img src="/${m.content}">`}
    <div class="time">${m.time}</div>
  `;

  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

form.onsubmit = e => {
  e.preventDefault();
  if (msg.value.trim() === "") return;
  socket.emit("send_message", {type:"text", content:msg.value});
  msg.value="";
};

img.onchange = () => {
  const f = img.files[0];
  const r = new FileReader();
  r.onload = () => socket.emit("send_image",{name:f.name,data:r.result});
  r.readAsArrayBuffer(f);
};
</script>

</body>
</html>



